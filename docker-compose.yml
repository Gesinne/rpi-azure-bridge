version: '3.8'

services:
  # Broker MQTT local
  mosquitto:
    image: eclipse-mosquitto:2
    container_name: mosquitto
    restart: unless-stopped
    ports:
      - "1883:1883"
    volumes:
      - ./mosquitto.conf:/mosquitto/config/mosquitto.conf
    
  # Puente MQTT → Azure
  mqtt-to-azure:
    build: .
    container_name: mqtt-to-azure
    restart: unless-stopped
    depends_on:
      - mosquitto
    environment:
      # Broker MQTT (contenedor mosquitto)
      - MQTT_BROKER=mosquitto
      - MQTT_PORT=1883
      - MQTT_TOPIC=#
      
      # Connection String del cliente (MODIFICAR)
      - AZURE_CONNECTION_STRING=HostName=xxx.azure-devices.net;DeviceId=xxx;SharedAccessKey=xxx
      
      # Intervalo de envío (1 para S1, 10 para F1 gratuito)
      - SEND_INTERVAL=1
