services:
  # Puente MQTT → Azure v2.0
  mqtt-to-azure:
    build: .
    container_name: mqtt-to-azure
    restart: unless-stopped
    network_mode: host
    environment:
      # Broker MQTT local (Mosquitto en la Raspberry)
      - MQTT_BROKER=localhost
      - MQTT_PORT=1883
      - MQTT_TOPIC=#
      
      # Connection String del cliente (MODIFICAR)
      - AZURE_CONNECTION_STRING=HostName=xxx.azure-devices.net;DeviceId=xxx;SharedAccessKey=xxx
      
      # Intervalo de envío (1 para S1, 10 para F1 gratuito)
      - SEND_INTERVAL=1
      
      # Puerto healthcheck (accesible en http://localhost:8080/health)
      - HEALTHCHECK_PORT=8080
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
